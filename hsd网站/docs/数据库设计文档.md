# QHSF-HSD 校园开发者社区管理系统 - 数据库设计文档

## 文档信息

- **项目名称**: QHSF-HSD 校园开发者社区管理系统
- **文档版本**: v1.0
- **编写日期**: 2025年11月
- **数据库设计师**: github6012
- **审核状态**: 待审核

## 1. 数据库概述

### 1.1 设计目标
- 支持校园开发者社区的完整业务流程
- 保证数据的一致性和完整性
- 提供高效的数据查询和操作性能
- 支持系统的扩展和维护需求

### 1.2 设计原则
- **规范化**: 遵循数据库设计范式，减少数据冗余
- **完整性**: 通过约束保证数据的准确性和一致性
- **性能**: 合理设计索引，优化查询性能
- **安全性**: 敏感数据加密存储，访问权限控制
- **可维护性**: 清晰的命名规范，完善的文档说明

### 1.3 技术选型
- **开发环境**: SQLite 3.x
- **生产环境**: PostgreSQL 13+ / MySQL 8.0+ (推荐PostgreSQL)
- **ORM框架**: SQLAlchemy 2.0+
- **迁移工具**: Flask-Migrate

## 2. 数据库架构

### 2.1 数据库结构图

```
QHSF_HSD_DB
├── 用户管理
│   ├── admin (管理员表)
│   └── student (学生表)
├── 内容管理
│   ├── news (新闻表)
│   ├── event (活动表)
│   └── timeline (时间线表)
├── 组织管理
│   ├── team (团队表)
│   └── partner (合作伙伴表)
└── 联系管理
    ├── contact_info (联系信息表)
    └── contact_message (联系消息表)
```

### 2.2 表关系图

```
┌─────────────┐    1:N    ┌─────────────┐
│    Admin    │◄─────────►│    News     │
└─────────────┘           └─────────────┘
       │ 1:N                     
       ▼                         
┌─────────────┐    1:N    ┌─────────────┐
│   Event     │           │  Timeline   │
└─────────────┘           └─────────────┘
       │                         │
       │ 1:N                     │ 1:N
       ▼                         ▼
┌─────────────┐           ┌─────────────┐
│   Student   │           │    Team     │
└─────────────┘           └─────────────┘
       │                         │
       │ 1:N                     │ 1:N
       ▼                         ▼
┌─────────────┐           ┌─────────────┐
│   Partner   │           │ContactInfo  │
└─────────────┘           └─────────────┘
                                 │ 1:N
                                 ▼
                          ┌─────────────┐
                          │ContactMessage│
                          └─────────────┘
```

## 3. 数据表设计

### 3.1 管理员表 (admin)

#### 3.1.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 管理员ID |
| username | VARCHAR | 80 | NOT NULL | - | - | - | 用户名 |
| password_hash | VARCHAR | 255 | NOT NULL | - | - | - | 密码哈希值 |
| email | VARCHAR | 120 | NULL | - | - | - | 邮箱地址 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 更新时间 |
| is_active | BOOLEAN | - | NOT NULL | TRUE | - | - | 是否激活 |
| last_login | DATETIME | - | NULL | - | - | - | 最后登录时间 |

#### 3.1.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 唯一索引
UNIQUE INDEX idx_admin_username (username)
UNIQUE INDEX idx_admin_email (email)

-- 普通索引
INDEX idx_admin_created_at (created_at)
INDEX idx_admin_is_active (is_active)
```

#### 3.1.3 约束条件
```sql
-- 检查约束
CHECK (LENGTH(username) >= 3)
CHECK (LENGTH(password_hash) >= 60)
CHECK (email LIKE '%@%.%' OR email IS NULL)

-- 触发器（更新时间自动更新）
CREATE TRIGGER update_admin_timestamp 
BEFORE UPDATE ON admin 
FOR EACH ROW 
SET NEW.updated_at = CURRENT_TIMESTAMP;
```

### 3.2 学生表 (student)

#### 3.2.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 学生ID |
| name | VARCHAR | 100 | NOT NULL | - | - | - | 姓名 |
| student_id | VARCHAR | 20 | NOT NULL | - | - | - | 学号 |
| major | VARCHAR | 100 | NOT NULL | - | - | - | 专业 |
| grade | VARCHAR | 20 | NOT NULL | - | - | - | 年级 |
| phone | VARCHAR | 20 | NULL | - | - | - | 电话号码 |
| email | VARCHAR | 120 | NULL | - | - | - | 邮箱地址 |
| qq | VARCHAR | 15 | NULL | - | - | - | QQ号码 |
| wechat | VARCHAR | 50 | NULL | - | - | - | 微信号 |
| skills | TEXT | - | NULL | - | - | - | 技能描述 |
| experience | TEXT | - | NULL | - | - | - | 经验描述 |
| motivation | TEXT | - | NULL | - | - | - | 加入动机 |
| status | VARCHAR | 20 | NOT NULL | 'pending' | - | - | 申请状态 |
| applied_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 申请时间 |
| reviewed_at | DATETIME | - | NULL | - | - | - | 审核时间 |
| reviewed_by | INTEGER | - | NULL | - | FK | admin.id | 审核人 |
| notes | TEXT | - | NULL | - | - | - | 备注信息 |

#### 3.2.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 唯一索引
UNIQUE INDEX idx_student_student_id (student_id)

-- 普通索引
INDEX idx_student_status (status)
INDEX idx_student_applied_at (applied_at)
INDEX idx_student_major (major)
INDEX idx_student_grade (grade)

-- 外键索引
INDEX idx_student_reviewed_by (reviewed_by)
```

#### 3.2.3 约束条件
```sql
-- 外键约束
FOREIGN KEY (reviewed_by) REFERENCES admin(id) ON DELETE SET NULL

-- 检查约束
CHECK (status IN ('pending', 'approved', 'rejected', 'withdrawn'))
CHECK (LENGTH(name) >= 2)
CHECK (LENGTH(student_id) >= 8)
CHECK (phone REGEXP '^[0-9+\-\s()]+$' OR phone IS NULL)
CHECK (email LIKE '%@%.%' OR email IS NULL)
```

### 3.3 新闻表 (news)

#### 3.3.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 新闻ID |
| title | VARCHAR | 200 | NOT NULL | - | - | - | 新闻标题 |
| content | TEXT | - | NOT NULL | - | - | - | 新闻内容 |
| summary | VARCHAR | 500 | NULL | - | - | - | 新闻摘要 |
| author_id | INTEGER | - | NOT NULL | - | FK | admin.id | 作者ID |
| category | VARCHAR | 50 | NOT NULL | 'general' | - | - | 新闻分类 |
| tags | VARCHAR | 200 | NULL | - | - | - | 标签 |
| image_url | VARCHAR | 500 | NULL | - | - | - | 封面图片URL |
| is_published | BOOLEAN | - | NOT NULL | FALSE | - | - | 是否发布 |
| is_featured | BOOLEAN | - | NOT NULL | FALSE | - | - | 是否置顶 |
| view_count | INTEGER | - | NOT NULL | 0 | - | - | 浏览次数 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 更新时间 |
| published_at | DATETIME | - | NULL | - | - | - | 发布时间 |

#### 3.3.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 外键索引
INDEX idx_news_author_id (author_id)

-- 查询优化索引
INDEX idx_news_published (is_published, published_at DESC)
INDEX idx_news_featured (is_featured, created_at DESC)
INDEX idx_news_category (category, created_at DESC)
INDEX idx_news_created_at (created_at DESC)

-- 全文索引
FULLTEXT INDEX idx_news_search (title, content, summary)
```

#### 3.3.3 约束条件
```sql
-- 外键约束
FOREIGN KEY (author_id) REFERENCES admin(id) ON DELETE CASCADE

-- 检查约束
CHECK (LENGTH(title) >= 5)
CHECK (LENGTH(content) >= 10)
CHECK (category IN ('general', 'announcement', 'activity', 'technology', 'recruitment'))
CHECK (view_count >= 0)
```

### 3.4 活动表 (event)

#### 3.4.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 活动ID |
| title | VARCHAR | 200 | NOT NULL | - | - | - | 活动标题 |
| description | TEXT | - | NOT NULL | - | - | - | 活动描述 |
| location | VARCHAR | 200 | NULL | - | - | - | 活动地点 |
| organizer_id | INTEGER | - | NOT NULL | - | FK | admin.id | 组织者ID |
| category | VARCHAR | 50 | NOT NULL | 'workshop' | - | - | 活动类型 |
| max_participants | INTEGER | - | NULL | - | - | - | 最大参与人数 |
| current_participants | INTEGER | - | NOT NULL | 0 | - | - | 当前参与人数 |
| registration_fee | DECIMAL | 10,2 | NOT NULL | 0.00 | - | - | 报名费用 |
| image_url | VARCHAR | 500 | NULL | - | - | - | 活动图片URL |
| is_published | BOOLEAN | - | NOT NULL | FALSE | - | - | 是否发布 |
| is_featured | BOOLEAN | - | NOT NULL | FALSE | - | - | 是否推荐 |
| registration_start | DATETIME | - | NULL | - | - | - | 报名开始时间 |
| registration_end | DATETIME | - | NULL | - | - | - | 报名结束时间 |
| event_start | DATETIME | - | NOT NULL | - | - | - | 活动开始时间 |
| event_end | DATETIME | - | NOT NULL | - | - | - | 活动结束时间 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 更新时间 |

#### 3.4.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 外键索引
INDEX idx_event_organizer_id (organizer_id)

-- 查询优化索引
INDEX idx_event_published (is_published, event_start ASC)
INDEX idx_event_featured (is_featured, event_start ASC)
INDEX idx_event_category (category, event_start ASC)
INDEX idx_event_time_range (event_start, event_end)
INDEX idx_event_registration (registration_start, registration_end)
```

#### 3.4.3 约束条件
```sql
-- 外键约束
FOREIGN KEY (organizer_id) REFERENCES admin(id) ON DELETE CASCADE

-- 检查约束
CHECK (LENGTH(title) >= 5)
CHECK (LENGTH(description) >= 10)
CHECK (category IN ('workshop', 'seminar', 'competition', 'networking', 'training'))
CHECK (max_participants IS NULL OR max_participants > 0)
CHECK (current_participants >= 0)
CHECK (current_participants <= COALESCE(max_participants, current_participants))
CHECK (registration_fee >= 0)
CHECK (event_end > event_start)
CHECK (registration_end IS NULL OR registration_start IS NULL OR registration_end >= registration_start)
CHECK (registration_start IS NULL OR registration_start <= event_start)
```

### 3.5 时间线表 (timeline)

#### 3.5.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 时间线ID |
| title | VARCHAR | 200 | NOT NULL | - | - | - | 事件标题 |
| description | TEXT | - | NULL | - | - | - | 事件描述 |
| event_date | DATE | - | NOT NULL | - | - | - | 事件日期 |
| event_type | VARCHAR | 50 | NOT NULL | 'milestone' | - | - | 事件类型 |
| importance | INTEGER | - | NOT NULL | 3 | - | - | 重要程度(1-5) |
| icon | VARCHAR | 50 | NULL | - | - | - | 图标名称 |
| color | VARCHAR | 7 | NULL | '#007bff' | - | - | 颜色代码 |
| is_visible | BOOLEAN | - | NOT NULL | TRUE | - | - | 是否显示 |
| created_by | INTEGER | - | NOT NULL | - | FK | admin.id | 创建者ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 更新时间 |

#### 3.5.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 外键索引
INDEX idx_timeline_created_by (created_by)

-- 查询优化索引
INDEX idx_timeline_visible (is_visible, event_date DESC)
INDEX idx_timeline_type (event_type, event_date DESC)
INDEX idx_timeline_importance (importance DESC, event_date DESC)
INDEX idx_timeline_date (event_date DESC)
```

#### 3.5.3 约束条件
```sql
-- 外键约束
FOREIGN KEY (created_by) REFERENCES admin(id) ON DELETE CASCADE

-- 检查约束
CHECK (LENGTH(title) >= 3)
CHECK (event_type IN ('milestone', 'achievement', 'announcement', 'activity', 'other'))
CHECK (importance BETWEEN 1 AND 5)
CHECK (color REGEXP '^#[0-9A-Fa-f]{6}$')
```

### 3.6 团队表 (team)

#### 3.6.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 团队成员ID |
| name | VARCHAR | 100 | NOT NULL | - | - | - | 姓名 |
| position | VARCHAR | 100 | NOT NULL | - | - | - | 职位 |
| department | VARCHAR | 100 | NULL | - | - | - | 部门 |
| bio | TEXT | - | NULL | - | - | - | 个人简介 |
| avatar_url | VARCHAR | 500 | NULL | - | - | - | 头像URL |
| email | VARCHAR | 120 | NULL | - | - | - | 邮箱地址 |
| github_url | VARCHAR | 200 | NULL | - | - | - | GitHub链接 |
| linkedin_url | VARCHAR | 200 | NULL | - | - | - | LinkedIn链接 |
| personal_website | VARCHAR | 200 | NULL | - | - | - | 个人网站 |
| skills | VARCHAR | 500 | NULL | - | - | - | 技能标签 |
| join_date | DATE | - | NULL | - | - | - | 加入日期 |
| is_active | BOOLEAN | - | NOT NULL | TRUE | - | - | 是否在职 |
| display_order | INTEGER | - | NOT NULL | 0 | - | - | 显示顺序 |
| is_featured | BOOLEAN | - | NOT NULL | FALSE | - | - | 是否重点展示 |
| created_by | INTEGER | - | NOT NULL | - | FK | admin.id | 创建者ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 更新时间 |

#### 3.6.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 外键索引
INDEX idx_team_created_by (created_by)

-- 查询优化索引
INDEX idx_team_active (is_active, display_order ASC)
INDEX idx_team_featured (is_featured, display_order ASC)
INDEX idx_team_department (department, display_order ASC)
INDEX idx_team_position (position)
```

#### 3.6.3 约束条件
```sql
-- 外键约束
FOREIGN KEY (created_by) REFERENCES admin(id) ON DELETE CASCADE

-- 检查约束
CHECK (LENGTH(name) >= 2)
CHECK (LENGTH(position) >= 2)
CHECK (email LIKE '%@%.%' OR email IS NULL)
CHECK (github_url LIKE 'https://github.com/%' OR github_url IS NULL)
CHECK (linkedin_url LIKE 'https://linkedin.com/%' OR linkedin_url IS NULL)
CHECK (display_order >= 0)
```

### 3.7 合作伙伴表 (partner)

#### 3.7.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 合作伙伴ID |
| name | VARCHAR | 100 | NOT NULL | - | - | - | 合作伙伴名称 |
| description | TEXT | - | NULL | - | - | - | 合作伙伴描述 |
| logo_url | VARCHAR | 500 | NULL | - | - | - | Logo URL |
| website_url | VARCHAR | 200 | NULL | - | - | - | 官方网站 |
| contact_email | VARCHAR | 120 | NULL | - | - | - | 联系邮箱 |
| contact_phone | VARCHAR | 20 | NULL | - | - | - | 联系电话 |
| partnership_type | VARCHAR | 50 | NOT NULL | 'sponsor' | - | - | 合作类型 |
| partnership_level | VARCHAR | 20 | NOT NULL | 'bronze' | - | - | 合作级别 |
| start_date | DATE | - | NULL | - | - | - | 合作开始日期 |
| end_date | DATE | - | NULL | - | - | - | 合作结束日期 |
| is_active | BOOLEAN | - | NOT NULL | TRUE | - | - | 是否有效 |
| display_order | INTEGER | - | NOT NULL | 0 | - | - | 显示顺序 |
| is_featured | BOOLEAN | - | NOT NULL | FALSE | - | - | 是否重点展示 |
| created_by | INTEGER | - | NOT NULL | - | FK | admin.id | 创建者ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 更新时间 |

#### 3.7.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 外键索引
INDEX idx_partner_created_by (created_by)

-- 查询优化索引
INDEX idx_partner_active (is_active, display_order ASC)
INDEX idx_partner_featured (is_featured, display_order ASC)
INDEX idx_partner_type (partnership_type, display_order ASC)
INDEX idx_partner_level (partnership_level, display_order ASC)
INDEX idx_partner_dates (start_date, end_date)
```

#### 3.7.3 约束条件
```sql
-- 外键约束
FOREIGN KEY (created_by) REFERENCES admin(id) ON DELETE CASCADE

-- 检查约束
CHECK (LENGTH(name) >= 2)
CHECK (partnership_type IN ('sponsor', 'technology', 'media', 'academic', 'community'))
CHECK (partnership_level IN ('bronze', 'silver', 'gold', 'platinum', 'diamond'))
CHECK (contact_email LIKE '%@%.%' OR contact_email IS NULL)
CHECK (website_url LIKE 'http%://%' OR website_url IS NULL)
CHECK (end_date IS NULL OR start_date IS NULL OR end_date >= start_date)
CHECK (display_order >= 0)
```

### 3.8 联系信息表 (contact_info)

#### 3.8.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 联系信息ID |
| organization_name | VARCHAR | 200 | NOT NULL | - | - | - | 组织名称 |
| address | TEXT | - | NULL | - | - | - | 地址 |
| phone | VARCHAR | 20 | NULL | - | - | - | 电话号码 |
| email | VARCHAR | 120 | NULL | - | - | - | 邮箱地址 |
| website | VARCHAR | 200 | NULL | - | - | - | 官方网站 |
| qq_group | VARCHAR | 50 | NULL | - | - | - | QQ群号 |
| wechat_group | VARCHAR | 100 | NULL | - | - | - | 微信群 |
| github_org | VARCHAR | 100 | NULL | - | - | - | GitHub组织 |
| office_hours | VARCHAR | 200 | NULL | - | - | - | 办公时间 |
| description | TEXT | - | NULL | - | - | - | 描述信息 |
| is_public | BOOLEAN | - | NOT NULL | TRUE | - | - | 是否公开显示 |
| updated_by | INTEGER | - | NOT NULL | - | FK | admin.id | 更新者ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 更新时间 |

#### 3.8.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 外键索引
INDEX idx_contact_info_updated_by (updated_by)

-- 查询优化索引
INDEX idx_contact_info_public (is_public)
```

#### 3.8.3 约束条件
```sql
-- 外键约束
FOREIGN KEY (updated_by) REFERENCES admin(id) ON DELETE CASCADE

-- 检查约束
CHECK (LENGTH(organization_name) >= 2)
CHECK (email LIKE '%@%.%' OR email IS NULL)
CHECK (website LIKE 'http%://%' OR website IS NULL)
CHECK (github_org LIKE 'https://github.com/%' OR github_org IS NULL)
```

### 3.9 联系消息表 (contact_message)

#### 3.9.1 表结构
| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 主键 | 外键 | 说明 |
|--------|----------|------|----------|--------|------|------|------|
| id | INTEGER | - | NOT NULL | AUTO_INCREMENT | PK | - | 消息ID |
| sender_name | VARCHAR | 100 | NOT NULL | - | - | - | 发送者姓名 |
| sender_email | VARCHAR | 120 | NOT NULL | - | - | - | 发送者邮箱 |
| sender_phone | VARCHAR | 20 | NULL | - | - | - | 发送者电话 |
| subject | VARCHAR | 200 | NOT NULL | - | - | - | 消息主题 |
| message | TEXT | - | NOT NULL | - | - | - | 消息内容 |
| message_type | VARCHAR | 50 | NOT NULL | 'inquiry' | - | - | 消息类型 |
| priority | VARCHAR | 20 | NOT NULL | 'normal' | - | - | 优先级 |
| status | VARCHAR | 20 | NOT NULL | 'unread' | - | - | 处理状态 |
| ip_address | VARCHAR | 45 | NULL | - | - | - | IP地址 |
| user_agent | VARCHAR | 500 | NULL | - | - | - | 用户代理 |
| assigned_to | INTEGER | - | NULL | - | FK | admin.id | 分配给 |
| replied_at | DATETIME | - | NULL | - | - | - | 回复时间 |
| reply_content | TEXT | - | NULL | - | - | - | 回复内容 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | - | - | 更新时间 |

#### 3.9.2 索引设计
```sql
-- 主键索引
PRIMARY KEY (id)

-- 外键索引
INDEX idx_contact_message_assigned_to (assigned_to)

-- 查询优化索引
INDEX idx_contact_message_status (status, created_at DESC)
INDEX idx_contact_message_type (message_type, created_at DESC)
INDEX idx_contact_message_priority (priority, created_at DESC)
INDEX idx_contact_message_email (sender_email)
INDEX idx_contact_message_created (created_at DESC)
```

#### 3.9.3 约束条件
```sql
-- 外键约束
FOREIGN KEY (assigned_to) REFERENCES admin(id) ON DELETE SET NULL

-- 检查约束
CHECK (LENGTH(sender_name) >= 2)
CHECK (sender_email LIKE '%@%.%')
CHECK (LENGTH(subject) >= 3)
CHECK (LENGTH(message) >= 10)
CHECK (message_type IN ('inquiry', 'complaint', 'suggestion', 'collaboration', 'other'))
CHECK (priority IN ('low', 'normal', 'high', 'urgent'))
CHECK (status IN ('unread', 'read', 'in_progress', 'resolved', 'closed'))
```

## 4. 数据字典

### 4.1 枚举值定义

#### 4.1.1 学生申请状态 (student.status)
| 值 | 说明 | 描述 |
|----|------|------|
| pending | 待审核 | 学生已提交申请，等待管理员审核 |
| approved | 已通过 | 申请已通过审核，学生成为社区成员 |
| rejected | 已拒绝 | 申请被拒绝，不符合加入条件 |
| withdrawn | 已撤回 | 学生主动撤回申请 |

#### 4.1.2 新闻分类 (news.category)
| 值 | 说明 | 描述 |
|----|------|------|
| general | 一般新闻 | 普通的社区新闻和资讯 |
| announcement | 公告通知 | 重要的官方公告和通知 |
| activity | 活动资讯 | 社区活动相关的新闻 |
| technology | 技术分享 | 技术文章和经验分享 |
| recruitment | 招募信息 | 人员招募和职位发布 |

#### 4.1.3 活动类型 (event.category)
| 值 | 说明 | 描述 |
|----|------|------|
| workshop | 工作坊 | 技能培训和实践活动 |
| seminar | 研讨会 | 学术讨论和经验分享 |
| competition | 竞赛 | 编程竞赛和技术比赛 |
| networking | 交流会 | 社交网络和人脉建设 |
| training | 培训 | 专业技能培训课程 |

#### 4.1.4 时间线事件类型 (timeline.event_type)
| 值 | 说明 | 描述 |
|----|------|------|
| milestone | 里程碑 | 重要的发展节点 |
| achievement | 成就 | 获得的荣誉和成果 |
| announcement | 公告 | 重要公告发布 |
| activity | 活动 | 重要活动举办 |
| other | 其他 | 其他类型的事件 |

#### 4.1.5 合作类型 (partner.partnership_type)
| 值 | 说明 | 描述 |
|----|------|------|
| sponsor | 赞助商 | 提供资金或物资支持 |
| technology | 技术合作 | 技术交流和合作 |
| media | 媒体合作 | 宣传推广合作 |
| academic | 学术合作 | 学术研究和教育合作 |
| community | 社区合作 | 其他社区组织合作 |

#### 4.1.6 合作级别 (partner.partnership_level)
| 值 | 说明 | 描述 |
|----|------|------|
| bronze | 铜牌 | 基础级别合作伙伴 |
| silver | 银牌 | 中级合作伙伴 |
| gold | 金牌 | 高级合作伙伴 |
| platinum | 白金 | 顶级合作伙伴 |
| diamond | 钻石 | 战略合作伙伴 |

#### 4.1.7 消息类型 (contact_message.message_type)
| 值 | 说明 | 描述 |
|----|------|------|
| inquiry | 咨询 | 一般性咨询和问题 |
| complaint | 投诉 | 意见和投诉 |
| suggestion | 建议 | 改进建议和意见 |
| collaboration | 合作 | 合作意向和提案 |
| other | 其他 | 其他类型的消息 |

#### 4.1.8 消息优先级 (contact_message.priority)
| 值 | 说明 | 描述 |
|----|------|------|
| low | 低 | 非紧急消息 |
| normal | 普通 | 一般优先级消息 |
| high | 高 | 重要消息 |
| urgent | 紧急 | 需要立即处理的消息 |

#### 4.1.9 消息状态 (contact_message.status)
| 值 | 说明 | 描述 |
|----|------|------|
| unread | 未读 | 新收到的消息 |
| read | 已读 | 已查看但未处理 |
| in_progress | 处理中 | 正在处理中 |
| resolved | 已解决 | 问题已解决 |
| closed | 已关闭 | 消息已关闭 |

### 4.2 字段长度规范

#### 4.2.1 字符串字段长度标准
| 字段类型 | 推荐长度 | 说明 |
|----------|----------|------|
| 用户名 | 80 | 支持中英文用户名 |
| 密码哈希 | 255 | bcrypt哈希值长度 |
| 邮箱地址 | 120 | 标准邮箱地址长度 |
| 电话号码 | 20 | 支持国际电话格式 |
| 姓名 | 100 | 支持中英文姓名 |
| 标题 | 200 | 新闻、活动标题 |
| URL地址 | 500 | 支持长URL |
| 短描述 | 500 | 摘要、简介等 |
| 颜色代码 | 7 | HEX颜色值 (#RRGGBB) |

#### 4.2.2 数值字段范围
| 字段类型 | 数据类型 | 范围 | 说明 |
|----------|----------|------|------|
| ID字段 | INTEGER | 1 ~ 2^31-1 | 自增主键 |
| 计数字段 | INTEGER | 0 ~ 2^31-1 | 浏览次数、参与人数等 |
| 重要程度 | INTEGER | 1 ~ 5 | 5级重要程度 |
| 显示顺序 | INTEGER | 0 ~ 999999 | 排序字段 |
| 金额字段 | DECIMAL(10,2) | 0.00 ~ 99999999.99 | 费用、价格等 |

## 5. 索引策略

### 5.1 索引设计原则
- **主键索引**: 每个表都有自增主键
- **外键索引**: 所有外键字段都建立索引
- **查询索引**: 根据常用查询条件建立复合索引
- **唯一索引**: 业务唯一字段建立唯一约束
- **全文索引**: 内容搜索字段建立全文索引

### 5.2 性能优化索引

#### 5.2.1 高频查询索引
```sql
-- 新闻列表查询（按发布状态和时间排序）
CREATE INDEX idx_news_list ON news (is_published, published_at DESC, is_featured DESC);

-- 活动列表查询（按时间范围和状态）
CREATE INDEX idx_event_list ON event (is_published, event_start ASC, event_end ASC);

-- 学生申请管理（按状态和申请时间）
CREATE INDEX idx_student_management ON student (status, applied_at DESC);

-- 消息处理（按状态和优先级）
CREATE INDEX idx_message_processing ON contact_message (status, priority DESC, created_at DESC);
```

#### 5.2.2 统计查询索引
```sql
-- 按月统计新闻发布量
CREATE INDEX idx_news_monthly_stats ON news (DATE_FORMAT(published_at, '%Y-%m'), is_published);

-- 按类型统计活动数量
CREATE INDEX idx_event_category_stats ON event (category, is_published, event_start);

-- 按状态统计学生申请
CREATE INDEX idx_student_status_stats ON student (status, applied_at);
```

## 6. 数据完整性

### 6.1 约束设计

#### 6.1.1 主键约束
- 所有表都使用自增整数作为主键
- 主键字段不允许为空且唯一

#### 6.1.2 外键约束
- 所有关联关系都通过外键约束保证
- 删除策略：CASCADE（级联删除）或SET NULL（设为空）
- 更新策略：CASCADE（级联更新）

#### 6.1.3 唯一约束
```sql
-- 管理员用户名唯一
ALTER TABLE admin ADD CONSTRAINT uk_admin_username UNIQUE (username);

-- 学生学号唯一
ALTER TABLE student ADD CONSTRAINT uk_student_id UNIQUE (student_id);

-- 管理员邮箱唯一（如果不为空）
ALTER TABLE admin ADD CONSTRAINT uk_admin_email UNIQUE (email);
```

#### 6.1.4 检查约束
```sql
-- 邮箱格式检查
ALTER TABLE admin ADD CONSTRAINT ck_admin_email 
CHECK (email IS NULL OR email REGEXP '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$');

-- 电话号码格式检查
ALTER TABLE student ADD CONSTRAINT ck_student_phone 
CHECK (phone IS NULL OR phone REGEXP '^[0-9+\-\s()]+$');

-- 日期逻辑检查
ALTER TABLE event ADD CONSTRAINT ck_event_dates 
CHECK (event_end > event_start);

-- 数值范围检查
ALTER TABLE timeline ADD CONSTRAINT ck_timeline_importance 
CHECK (importance BETWEEN 1 AND 5);
```

### 6.2 数据验证规则

#### 6.2.1 必填字段验证
- 所有NOT NULL字段在应用层进行验证
- 关键业务字段不允许空值

#### 6.2.2 格式验证
- 邮箱地址格式验证
- URL格式验证
- 电话号码格式验证
- 日期时间格式验证

#### 6.2.3 业务逻辑验证
- 活动结束时间必须晚于开始时间
- 报名结束时间必须早于活动开始时间
- 当前参与人数不能超过最大参与人数
- 合作结束日期必须晚于开始日期

## 7. 安全设计

### 7.1 数据安全

#### 7.1.1 敏感数据加密
```sql
-- 密码字段使用bcrypt加密存储
-- 应用层实现：
-- password_hash = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())
```

#### 7.1.2 数据脱敏
- 生产环境导出数据时对敏感字段进行脱敏
- 测试环境使用脱敏后的数据

#### 7.1.3 访问控制
- 数据库用户权限最小化原则
- 应用程序使用专用数据库用户
- 禁止直接访问生产数据库

### 7.2 SQL注入防护

#### 7.2.1 参数化查询
```python
# 使用SQLAlchemy ORM防止SQL注入
user = User.query.filter_by(username=username).first()

# 原生SQL使用参数化查询
cursor.execute("SELECT * FROM admin WHERE username = %s", (username,))
```

#### 7.2.2 输入验证
- 所有用户输入都进行验证和过滤
- 使用白名单方式验证输入内容
- 对特殊字符进行转义处理

## 8. 备份与恢复

### 8.1 备份策略

#### 8.1.1 备份类型
- **全量备份**: 每周进行一次完整数据库备份
- **增量备份**: 每日进行增量数据备份
- **实时备份**: 关键操作实时同步备份

#### 8.1.2 备份脚本示例
```bash
#!/bin/bash
# SQLite备份脚本
DB_PATH="/path/to/database.db"
BACKUP_DIR="/path/to/backup"
DATE=$(date +%Y%m%d_%H%M%S)

# 创建备份
sqlite3 $DB_PATH ".backup $BACKUP_DIR/backup_$DATE.db"

# 压缩备份文件
gzip $BACKUP_DIR/backup_$DATE.db

# 删除7天前的备份
find $BACKUP_DIR -name "backup_*.db.gz" -mtime +7 -delete
```

### 8.2 恢复策略

#### 8.2.1 恢复流程
1. 停止应用服务
2. 备份当前数据库
3. 恢复指定备份文件
4. 验证数据完整性
5. 重启应用服务

#### 8.2.2 恢复脚本示例
```bash
#!/bin/bash
# SQLite恢复脚本
BACKUP_FILE=$1
DB_PATH="/path/to/database.db"

if [ -z "$BACKUP_FILE" ]; then
    echo "Usage: $0 <backup_file>"
    exit 1
fi

# 备份当前数据库
cp $DB_PATH $DB_PATH.before_restore

# 恢复数据库
gunzip -c $BACKUP_FILE > $DB_PATH

echo "Database restored from $BACKUP_FILE"
```

## 9. 性能优化

### 9.1 查询优化

#### 9.1.1 常用查询优化
```sql
-- 优化前：全表扫描
SELECT * FROM news WHERE title LIKE '%关键词%';

-- 优化后：使用全文索引
SELECT * FROM news WHERE MATCH(title, content) AGAINST('关键词' IN NATURAL LANGUAGE MODE);

-- 分页查询优化
SELECT * FROM news 
WHERE is_published = 1 
ORDER BY published_at DESC 
LIMIT 10 OFFSET 20;
```

#### 9.1.2 索引使用建议
- 避免在WHERE子句中使用函数
- 合理使用复合索引的最左前缀原则
- 定期分析查询执行计划
- 监控慢查询日志

### 9.2 数据库配置优化

#### 9.2.1 SQLite优化配置
```sql
-- 启用WAL模式提高并发性能
PRAGMA journal_mode = WAL;

-- 设置缓存大小
PRAGMA cache_size = 10000;

-- 启用外键约束
PRAGMA foreign_keys = ON;

-- 设置同步模式
PRAGMA synchronous = NORMAL;
```

#### 9.2.2 连接池配置
```python
# SQLAlchemy连接池配置
engine = create_engine(
    'sqlite:///database.db',
    pool_size=20,
    max_overflow=30,
    pool_timeout=30,
    pool_recycle=3600
)
```

## 10. 监控与维护

### 10.1 性能监控

#### 10.1.1 关键指标
- 查询响应时间
- 数据库连接数
- 慢查询统计
- 索引使用率
- 数据库文件大小

#### 10.1.2 监控脚本
```python
# 数据库性能监控
import sqlite3
import time

def monitor_database_performance():
    conn = sqlite3.connect('database.db')
    cursor = conn.cursor()
    
    # 检查表大小
    cursor.execute("SELECT name FROM sqlite_master WHERE type='table'")
    tables = cursor.fetchall()
    
    for table in tables:
        cursor.execute(f"SELECT COUNT(*) FROM {table[0]}")
        count = cursor.fetchone()[0]
        print(f"Table {table[0]}: {count} records")
    
    conn.close()
```

### 10.2 维护任务

#### 10.2.1 定期维护
- 数据库统计信息更新
- 索引重建和优化
- 过期数据清理
- 日志文件轮转

#### 10.2.2 维护脚本
```sql
-- 清理过期数据
DELETE FROM contact_message 
WHERE status = 'closed' 
AND updated_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- 重建索引
REINDEX;

-- 分析表统计信息
ANALYZE;
```

## 11. 数据迁移

### 11.1 版本控制

#### 11.1.1 迁移文件命名规范
```
migrations/
├── 001_initial_schema.sql
├── 002_add_student_table.sql
├── 003_add_timeline_table.sql
├── 004_add_indexes.sql
└── 005_add_constraints.sql
```

#### 11.1.2 迁移脚本示例
```sql
-- 001_initial_schema.sql
-- 创建管理员表
CREATE TABLE admin (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(80) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(120) UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    last_login DATETIME
);

-- 插入默认管理员
INSERT INTO admin (username, password_hash, email) 
VALUES ('admin', '$2b$12$...', 'admin@example.com');
```

### 11.2 数据导入导出

#### 11.2.1 数据导出
```python
# 导出学生数据为CSV
import csv
import sqlite3

def export_students_to_csv():
    conn = sqlite3.connect('database.db')
    cursor = conn.cursor()
    
    cursor.execute("""
        SELECT name, student_id, major, grade, phone, email, status, applied_at
        FROM student
        ORDER BY applied_at DESC
    """)
    
    with open('students_export.csv', 'w', newline='', encoding='utf-8') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(['姓名', '学号', '专业', '年级', '电话', '邮箱', '状态', '申请时间'])
        writer.writerows(cursor.fetchall())
    
    conn.close()
```

#### 11.2.2 数据导入
```python
# 从CSV导入学生数据
def import_students_from_csv(csv_file):
    conn = sqlite3.connect('database.db')
    cursor = conn.cursor()
    
    with open(csv_file, 'r', encoding='utf-8') as csvfile:
        reader = csv.DictReader(csvfile)
        for row in reader:
            cursor.execute("""
                INSERT INTO student (name, student_id, major, grade, phone, email, status)
                VALUES (?, ?, ?, ?, ?, ?, ?)
            """, (row['姓名'], row['学号'], row['专业'], row['年级'], 
                  row['电话'], row['邮箱'], row['状态']))
    
    conn.commit()
    conn.close()
```

## 12. 总结

### 12.1 设计特点
- **完整性**: 覆盖了系统所有核心业务功能
- **规范性**: 遵循数据库设计最佳实践
- **扩展性**: 预留了系统扩展的空间
- **安全性**: 考虑了数据安全和访问控制
- **性能**: 合理的索引设计保证查询效率

### 12.2 技术优势
- 使用成熟的关系型数据库设计
- 支持ACID事务特性
- 完善的约束和验证机制
- 灵活的查询和统计功能

### 12.3 维护建议
- 定期监控数据库性能
- 及时清理过期和无用数据
- 保持备份策略的有效性
- 根据业务发展调整数据库结构

### 12.4 未来规划
- 考虑分库分表策略
- 引入缓存机制提高性能
- 支持读写分离架构
- 集成数据分析和报表功能

---

**文档状态**: 初稿完成  
**审核状态**: 待审核  
**下次更新**: 根据系统需求变化更新