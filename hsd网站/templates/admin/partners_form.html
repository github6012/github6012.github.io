<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ '编辑合作伙伴' if partner else '添加合作伙伴' }} - 管理后台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .main-content {
            padding: 20px;
        }
        .preview-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            background-color: white;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .preview-logo {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 0 1px #dee2e6;
            cursor: pointer;
            margin: 2px;
            display: inline-block;
        }
        .color-option.selected {
            box-shadow: 0 0 0 3px #0d6efd;
        }
        .icon-grid {
            max-height: 300px;
            overflow-y: auto;
        }
        .icon-option {
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border: 1px solid transparent;
            border-radius: 4px;
            margin: 2px;
        }
        .icon-option:hover {
            background-color: #f8f9fa;
            border-color: #dee2e6;
        }
        .icon-option.selected {
            background-color: #e7f3ff;
            border-color: #0d6efd;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
        <!-- 统一侧边栏 -->
        {% include 'admin/sidebar.html' %}

            <!-- 主内容区域 -->
            <main class="main-content">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>{{ '编辑合作伙伴' if partner else '添加合作伙伴' }}</h2>
                    <a href="{{ url_for('admin_partners') }}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left me-2"></i>返回列表
                    </a>
                </div>

                <!-- Flash 消息 -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <div class="row">
                    <!-- 表单 -->
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-body">
                                <form method="POST">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">合作伙伴名称 <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="name" name="name" 
                                               value="{{ partner.name if partner else '' }}" required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="website_url" class="form-label">官网链接</label>
                                        <input type="url" class="form-control" id="website_url" name="website_url" 
                                               value="{{ partner.website_url if partner else '' }}" 
                                               placeholder="https://example.com">
                                    </div>

                                    <div class="mb-3">
                                        <label for="description" class="form-label">描述</label>
                                        <textarea class="form-control" id="description" name="description" rows="3" 
                                                  placeholder="简要描述合作伙伴">{{ partner.description if partner else '' }}</textarea>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">图标选择</label>
                                        <div class="border rounded p-3">
                                            <div class="row icon-grid">
                                                {% set common_icons = [
                                                    'fas fa-building', 'fas fa-industry', 'fas fa-university', 'fas fa-hospital',
                                                    'fas fa-school', 'fas fa-store', 'fas fa-home', 'fas fa-city',
                                                    'fas fa-globe', 'fas fa-laptop', 'fas fa-mobile-alt', 'fas fa-desktop',
                                                    'fas fa-server', 'fas fa-database', 'fas fa-cloud', 'fas fa-wifi',
                                                    'fas fa-cog', 'fas fa-tools', 'fas fa-wrench', 'fas fa-hammer',
                                                    'fas fa-chart-line', 'fas fa-chart-bar', 'fas fa-chart-pie', 'fas fa-analytics',
                                                    'fas fa-handshake', 'fas fa-users', 'fas fa-user-tie', 'fas fa-briefcase',
                                                    'fas fa-graduation-cap', 'fas fa-book', 'fas fa-microscope', 'fas fa-flask',
                                                    'fas fa-heart', 'fas fa-star', 'fas fa-trophy', 'fas fa-medal',
                                                    'fab fa-microsoft', 'fab fa-apple', 'fab fa-google', 'fab fa-amazon',
                                                    'fab fa-facebook', 'fab fa-twitter', 'fab fa-linkedin', 'fab fa-github'
                                                ] %}
                                                {% for icon in common_icons %}
                                                    <div class="col-2">
                                                        <div class="icon-option {{ 'selected' if partner and partner.icon_class == icon else '' }}" 
                                                             data-icon="{{ icon }}">
                                                            <i class="{{ icon }} fa-2x"></i>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            <input type="hidden" id="icon_class" name="icon_class" 
                                                   value="{{ partner.icon_class if partner else 'fas fa-building' }}">
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">图标颜色</label>
                                        <div class="d-flex flex-wrap">
                                            {% set colors = [
                                                ('primary', '#0d6efd'), ('secondary', '#6c757d'), ('success', '#198754'),
                                                ('danger', '#dc3545'), ('warning', '#ffc107'), ('info', '#0dcaf0'),
                                                ('dark', '#212529'), ('purple', '#6f42c1'), ('pink', '#d63384'),
                                                ('orange', '#fd7e14'), ('teal', '#20c997'), ('cyan', '#0dcaf0')
                                            ] %}
                                            {% for color_name, color_hex in colors %}
                                                <div class="color-option {{ 'selected' if partner and partner.icon_color == color_name else '' }}" 
                                                     style="background-color: {{ color_hex }};" 
                                                     data-color="{{ color_name }}" 
                                                     title="{{ color_name }}"></div>
                                            {% endfor %}
                                            <input type="hidden" id="icon_color" name="icon_color" 
                                                   value="{{ partner.icon_color if partner else 'primary' }}">
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="order_index" class="form-label">排序</label>
                                        <input type="number" class="form-control" id="order_index" name="order_index" 
                                               value="{{ partner.order_index if partner else 0 }}" min="0">
                                        <div class="form-text">数字越小排序越靠前</div>
                                    </div>

                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="is_published" name="is_published" 
                                                   {{ 'checked' if not partner or partner.is_published else '' }}>
                                            <label class="form-check-label" for="is_published">
                                                发布到前台
                                            </label>
                                        </div>
                                    </div>

                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-check-circle me-2"></i>{{ '更新' if partner else '添加' }}
                                        </button>
                                        <a href="{{ url_for('admin_partners') }}" class="btn btn-secondary">
                                            <i class="bi bi-x-circle me-2"></i>取消
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- 预览 -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">实时预览</h5>
                            </div>
                            <div class="card-body">
                                <div class="preview-card">
                                    <div class="preview-logo bg-white" id="preview-logo">
                                        <i id="preview-icon" class="{{ partner.icon_class if partner else 'fas fa-building' }} fa-3x text-{{ partner.icon_color if partner else 'primary' }}"></i>
                                    </div>
                                    <h5 id="preview-name" class="mb-2">{{ partner.name if partner else '合作伙伴名称' }}</h5>
                                    <p id="preview-description" class="text-muted small mb-2">{{ partner.description if partner and partner.description else '合作伙伴描述' }}</p>
                                    <p id="preview-website" class="text-muted small mb-0" style="{{ 'display: none;' if not partner or not partner.website_url else '' }}">
                                        <i class="bi bi-link-45deg"></i>
                                        <a href="#" target="_blank" class="text-decoration-none">访问官网</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 实时预览功能
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('name');
            const descriptionInput = document.getElementById('description');
            const websiteInput = document.getElementById('website_url');
            const previewName = document.getElementById('preview-name');
            const previewDescription = document.getElementById('preview-description');
            const previewWebsite = document.getElementById('preview-website');
            const previewIcon = document.getElementById('preview-icon');
            
            // 图标选择
            document.querySelectorAll('.icon-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.icon-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    const iconClass = this.dataset.icon;
                    document.getElementById('icon_class').value = iconClass;
                    updatePreviewIcon();
                });
            });
            
            // 颜色选择
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    const color = this.dataset.color;
                    document.getElementById('icon_color').value = color;
                    updatePreviewIcon();
                });
            });
            
            // 更新预览图标
            function updatePreviewIcon() {
                const iconClass = document.getElementById('icon_class').value;
                const iconColor = document.getElementById('icon_color').value;
                previewIcon.className = iconClass + ' fa-3x text-' + iconColor;
            }
            
            // 名称输入
            nameInput.addEventListener('input', function() {
                previewName.textContent = this.value || '合作伙伴名称';
            });
            
            // 描述输入
            descriptionInput.addEventListener('input', function() {
                previewDescription.textContent = this.value || '合作伙伴描述';
            });
            
            // 网站链接输入
            websiteInput.addEventListener('input', function() {
                if (this.value) {
                    previewWebsite.style.display = 'block';
                    previewWebsite.querySelector('a').href = this.value;
                } else {
                    previewWebsite.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>